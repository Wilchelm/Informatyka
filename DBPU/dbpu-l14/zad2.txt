Istnieje szereg problemÃ³w zwiÄ…zanych z bezpieczeÅ„stwem kodowania, gdy producent i konsument nie zgadzajÄ… siÄ™ co do uÅ¼ywanego kodowania lub sposobu implementacji danego kodowania. Na przykÅ‚ad w 2011 r. ZgÅ‚oszono atak, w ktÃ³rym bajt wiodÄ…cy Shift_JIS 0x82 zostaÅ‚ uÅ¼yty do â€zamaskowaniaâ€ bajtu szlaku 0x22 w zasobie JSON, ktÃ³rego atakujÄ…cy mÃ³gÅ‚ kontrolowaÄ‡ niektÃ³re pola. Producent nie widziaÅ‚ problemu, mimo Å¼e jest to nielegalna kombinacja bajtÃ³w. Konsument zdekodowaÅ‚ go jako pojedynczy U + FFFD i dlatego zmieniÅ‚ ogÃ³lnÄ… interpretacjÄ™, poniewaÅ¼ U + 0022 jest waÅ¼nym ogranicznikiem. Dekodery kodowania, ktÃ³re uÅ¼ywajÄ… wielu bajtÃ³w dla wartoÅ›ci skalarnych, wymagajÄ… obecnie, aby w przypadku niedozwolonej kombinacji bajtÃ³w wartoÅ›Ä‡ skalarna z zakresu od U + 0000 do U + 007F wÅ‚Ä…cznie nie mogÅ‚a byÄ‡ â€zamaskowanaâ€. Dla wyÅ¼ej wymienionej sekwencji wyjÅ›ciem byÅ‚oby U + FFFD U + 0022.

Jest to wiÄ™kszy problem w przypadku kodowania, ktÃ³re odwzorowuje wszystko, co jest bajtem ASCII, na coÅ›, co nie jest kodem ASCII, gdy nie ma bajtu wiodÄ…cego. SÄ… to kodowania â€niezgodne z ASCIIâ€ i inne niÅ¼ ISO-2022-JP, UTF-16BE i UTF-16LE, ktÃ³re niestety sÄ… wymagane ze wzglÄ™du na wdroÅ¼onÄ… treÅ›Ä‡, nie sÄ… obsÅ‚ugiwane. (Trwa badanie, czy wiÄ™cej etykiet innych takich kodowaÅ„ moÅ¼e zostaÄ‡ zamapowanych na kodowanie zastÄ™pcze, a nie na nieznane awarie kodowania). PrzykÅ‚adowym atakiem jest wstrzykniÄ™cie starannie spreparowanej treÅ›ci do zasobu, a nastÄ™pnie zachÄ™cenie uÅ¼ytkownika do zastÄ…pienia kodowania, co powoduje na przykÅ‚ad wykonanie skryptu.

Kodery uÅ¼ywane przez adresy URL znajdujÄ…ce siÄ™ w HTML i funkcji formularza HTML mogÄ… rÃ³wnieÅ¼ powodowaÄ‡ niewielkÄ… utratÄ™ informacji, gdy stosowane jest kodowanie, ktÃ³re nie moÅ¼e reprezentowaÄ‡ wszystkich wartoÅ›ci skalarnych. Na przykÅ‚ad. gdy zasÃ³b korzysta z kodowania Windows-1252, serwer nie bÄ™dzie w stanie odrÃ³Å¼niÄ‡ uÅ¼ytkownika koÅ„cowego wprowadzajÄ…cego â€ğŸ’©â€ i â€& # 128169;â€ w formÄ™.

Przedstawione tutaj problemy znikajÄ…, gdy uÅ¼ywa siÄ™ wyÅ‚Ä…cznie UTF-8, co jest jednym z wielu powodÃ³w, ktÃ³re sÄ… obecnie obowiÄ…zkowym kodowaniem wszystkich rzeczy.

Byte order mark

Wiele programÃ³w Windows (w tym starsze wersje Notatnika Windows) dodaje bajty 0xEF, 0xBB, 0xBF na poczÄ…tku kaÅ¼dego dokumentu zapisanego jako UTF-8. Jest to kodowanie UTF-8 znaku kolejnoÅ›ci bajtÃ³w Unicode (BOM) i jest powszechnie okreÅ›lane jako BOM UTF-8, nawet jeÅ›li kolejnoÅ›Ä‡ bajtÃ³w nie ma znaczenia dla UTF-8. ChociaÅ¼ tekst ASCII zakodowany przy uÅ¼yciu UTF-8 zwykle jest wstecznie kompatybilny z ASCII, nie jest to prawdÄ…, gdy zalecenia Standardu Unicode sÄ… ignorowane i dodawana jest BOM. Oprogramowanie inne niÅ¼ UTF-8 moÅ¼e wyÅ›wietlaÄ‡ BOM jako trzy Å›mieciowe znaki, np. â€Ã¯Â» Â¿â€w oprogramowaniu interpretujÄ…cym dokument jako ISO 8859-1 lub Windows-1252 orazâ€ âˆ©â•—â” â€, jeÅ›li jest interpretowany jako strona kodowa 437. Jest to przykÅ‚ad mojibake, wynik znieksztaÅ‚conego tekstu podczas dekodowania tekstu przy uÅ¼yciu niezamierzone kodowanie znakÃ³w.

Standard Unicode nie wymaga ani nie zaleca uÅ¼ywania BOM dla UTF-8, ale ostrzega, Å¼e â€‹â€‹moÅ¼na go napotkaÄ‡ na poczÄ…tku pliku transkodowanego z innego kodowania. ObecnoÅ›Ä‡ BOM UTF-8 moÅ¼e powodowaÄ‡ problemy z istniejÄ…cym oprogramowaniem obsÅ‚ugujÄ…cym UTF-8, na przykÅ‚ad:

    Parsery jÄ™zyka programowania, ktÃ³re nie zostaÅ‚y wyraÅºnie zaprojektowane dla UTF-8, mogÄ… czÄ™sto obsÅ‚ugiwaÄ‡ UTF-8 w staÅ‚ych ciÄ…gÃ³w i komentarzach, ale nie mogÄ… analizowaÄ‡ BOM UTF-8 na poczÄ…tku pliku.
    Programy, ktÃ³re identyfikujÄ… typy plikÃ³w za pomocÄ… wiodÄ…cych znakÃ³w, mogÄ… nie zidentyfikowaÄ‡ pliku, jeÅ›li BOM UTF-8 jest obecny, nawet jeÅ›li uÅ¼ytkownik pliku moÅ¼e obsÅ‚uÅ¼yÄ‡ BOM. PrzykÅ‚adem jest uniksowa skÅ‚adnia shebang, inna to Internet Explorer, ktÃ³ry bÄ™dzie renderowaÅ‚ strony w trybie standardÃ³w tylko wtedy, gdy zacznie siÄ™ od deklaracji typu dokumentu.
    Programy, ktÃ³re wstawiajÄ… informacje na poczÄ…tku pliku, przestanÄ… uÅ¼ywaÄ‡ BOM do identyfikacji UTF-8 (jednym z przykÅ‚adÃ³w sÄ… przeglÄ…darki offline, ktÃ³re dodajÄ… ÅºrÃ³dÅ‚owy adres URL na poczÄ…tku pliku).

Niemniej jednak niektÃ³re programy, takie jak edytory tekstu, odmawiajÄ… poprawnego wyÅ›wietlania lub interpretacji UTF-8, chyba Å¼e tekst zaczyna siÄ™ znakiem bajtu lub zawiera tylko ASCII.

Konsorcjum Unicode rozpoznaÅ‚o problem z wieloma reprezentacjami i zmieniÅ‚o Standard Unicode, aby uniemoÅ¼liwiÄ‡ wielokrotne reprezentacje tego samego punktu kodowego przy UTF-8. Sprostowanie UTF-8 wymienia nowo ograniczony zakres UTF-8 (patrz referencje). Wiele obecnych aplikacji mogÅ‚o nie zostaÄ‡ zmienionych w celu przestrzegania tej zasady. SprawdÅº, czy aplikacja jest zgodna z najnowszÄ… specyfikacjÄ… kodowania UTF-8. ZwrÃ³Ä‡ szczegÃ³lnÄ… uwagÄ™ na filtrowanie nielegalnych znakÃ³w.

DokÅ‚adna odpowiedÅº wymagana od dekodera UTF-8 na nieprawidÅ‚owe wejÅ›cie nie jest jednolicie zdefiniowana przez standardy. Zasadniczo istnieje kilka sposobÃ³w zachowania dekodera UTF-8 w przypadku nieprawidÅ‚owej sekwencji bajtÃ³w:

    1. Wpisz znak zastÄ™pczy (np. â€?â€, â€â€).
    2. Zignoruj â€‹â€‹bajty.
    3. Interpretuj bajty zgodnie z innym kodowaniem znakÃ³w (czÄ™sto mapa znakÃ³w ISO-8859-1).
    4. Nie zauwaÅ¼aj i nie dekoduj tak, jakby bajty byÅ‚y jakimÅ› podobnym bitem UTF-8.
    5. Zatrzymaj dekodowanie i zgÅ‚oÅ› bÅ‚Ä…d (prawdopodobnie dajÄ…c dzwoniÄ…cemu opcjÄ™ kontynuacji).

Dekoder moÅ¼e zachowywaÄ‡ siÄ™ w rÃ³Å¼ny sposÃ³b dla rÃ³Å¼nych typÃ³w nieprawidÅ‚owych danych wejÅ›ciowych.

RFC 3629 wymaga jedynie, aby dekodery UTF-8 nie dekodowaÅ‚y â€dÅ‚ugich sekwencjiâ€ (gdzie znak jest zakodowany w wiÄ™kszej liczbie bajtÃ³w niÅ¼ jest to konieczne, ale nadal przestrzega powyÅ¼szych formularzy). Standard Unicode wymaga dekodera zgodnego z Unicode, aby â€... traktowaÄ‡ kaÅ¼dÄ… Åºle sformuÅ‚owanÄ… sekwencjÄ™ jednostek kodu jako warunek bÅ‚Ä™du. Gwarantuje to, Å¼e nie bÄ™dzie ona interpretowaÄ‡ ani emitowaÄ‡ nieprawidÅ‚owej sekwencji jednostek koduâ€.

PrzedÅ‚uÅ¼one formularze sÄ… jednym z najbardziej kÅ‚opotliwych typÃ³w danych UTF-8. Obecny RFC mÃ³wi, Å¼e nie naleÅ¼y ich dekodowaÄ‡, ale starsze specyfikacje dla UTF-8 daÅ‚y tylko ostrzeÅ¼enie i wiele prostszych dekoderÃ³w z przyjemnoÅ›ciÄ… je zdekoduje. Zbyt dÅ‚ugie formularze zostaÅ‚y wykorzystane do ominiÄ™cia sprawdzania poprawnoÅ›ci zabezpieczeÅ„ w gÅ‚oÅ›nych produktach, w tym na serwerze internetowym Microsoft IIS. Dlatego naleÅ¼y bardzo uwaÅ¼aÄ‡, aby uniknÄ…Ä‡ problemÃ³w zwiÄ…zanych z bezpieczeÅ„stwem, jeÅ›li sprawdzanie poprawnoÅ›ci odbywa siÄ™ przed konwersjÄ… z UTF-8, i ogÃ³lnie znacznie Å‚atwiej jest obsÅ‚ugiwaÄ‡ zbyt dÅ‚ugie formularze przed wykonaniem jakiejkolwiek weryfikacji danych wejÅ›ciowych.

Aby zachowaÄ‡ bezpieczeÅ„stwo w przypadku nieprawidÅ‚owych danych wejÅ›ciowych, istniejÄ… dwie opcje. Pierwszym z nich jest zdekodowanie UTF-8 przed wykonaniem jakichkolwiek sprawdzeÅ„ poprawnoÅ›ci danych wejÅ›ciowych. Drugim jest uÅ¼ycie dekodera, ktÃ³ry w przypadku nieprawidÅ‚owego wprowadzenia zwraca bÅ‚Ä…d lub tekst, ktÃ³ry aplikacja uwaÅ¼a za nieszkodliwy. InnÄ… moÅ¼liwoÅ›ciÄ… jest caÅ‚kowite unikniÄ™cie konwersji z UTF-8, ale zaleÅ¼y to od innego oprogramowania, ktÃ³re dane sÄ… przekazywane do bezpiecznego przetwarzania nieprawidÅ‚owych danych.

Innym zagadnieniem jest odzyskiwanie po bÅ‚Ä™dzie. Aby zagwarantowaÄ‡ prawidÅ‚owe odzyskiwanie po uszkodzonych lub utraconych bajtach, dekodery muszÄ… byÄ‡ w stanie rozpoznaÄ‡ rÃ³Å¼nicÄ™ miÄ™dzy bajtami wiodÄ…cymi i bajtowymi, a nie tylko zakÅ‚adaÄ‡, Å¼e bajty bÄ™dÄ… typu dozwolonego na ich pozycji.
Ze wzglÄ™dÃ³w bezpieczeÅ„stwa dekoder UTF-8 nie moÅ¼e akceptowaÄ‡ sekwencji UTF-8 dÅ‚uÅ¼szych niÅ¼ jest to konieczne do zakodowania znaku. JeÅ›li uÅ¼ywasz analizatora skÅ‚adni do dekodowania kodowania UTF-8, upewnij siÄ™, Å¼e analizator skÅ‚adni filtruje niepoprawne znaki UTF-8 (nieprawidÅ‚owe formularze lub formularze zbyt dÅ‚ugie).
Poszukaj zbyt dÅ‚ugich sekwencji UTF-8, zaczynajÄ…c od zÅ‚oÅ›liwego wzorca. MoÅ¼esz takÅ¼e uÅ¼yÄ‡ testu warunkÃ³w skrajnych dekodera UTF-8, aby przetestowaÄ‡ parser UTF-8 (zobacz Markus Kuhn UTF-8 i FAQ dotyczÄ…ce Unicode w czÄ™Å›ci referencyjnej)
ZaÅ‚Ã³Å¼my, Å¼e wszystkie dane wejÅ›ciowe sÄ… zÅ‚oÅ›liwe. UtwÃ³rz biaÅ‚Ä… listÄ™, ktÃ³ra definiuje wszystkie prawidÅ‚owe dane wejÅ›ciowe do systemu oprogramowania na podstawie specyfikacji wymagaÅ„. Dane, ktÃ³re nie pasujÄ… do biaÅ‚ej listy, nie powinny byÄ‡ dopuszczane do systemu. Przetestuj proces dekodowania pod kÄ…tem zÅ‚oÅ›liwych danych wejÅ›ciowych.

Wizualne spoofing: powiedz, Å¼e masz forum z uÅ¼ytkownikiem o nazwie "admin", ktÃ³remu wszyscy ufajÄ…. KtoÅ› inny moÅ¼e zarejestrowaÄ‡ konto uÅ¼ytkownika o nazwie "Ğ°dmin" (pierwsza litera to cyrylica a) i oszukaÄ‡ innych, by myÅ›leli, Å¼e to administrator strony. Jest to gÅ‚Ã³wnie technika inÅ¼ynierii spoÅ‚ecznej: jest maÅ‚o prawdopodobne, aby jakiekolwiek oprogramowanie pomieszaÅ‚o uÅ¼ytkownikÃ³w. (Ten konkretny przykÅ‚ad moÅ¼na czÄ™Å›ciowo rozwiÄ…zaÄ‡, dodajÄ…c do strony specjalne formatowanie lub styl w pobliÅ¼u nazwy administratora, dziÄ™ki czemu nazwy profilu sÄ… linkami do stron profilu, ktÃ³re pokazujÄ… historiÄ™ aktywnoÅ›ci uÅ¼ytkownika i datÄ™ doÅ‚Ä…czenia itp., DziÄ™ki czemu uÅ¼ytkownicy mogÄ… identyfikowaÄ‡ innych na rÃ³Å¼ne sposoby oprÃ³cz ich widocznej moÅ¼liwej do wymyÅ›lenia nazwy. Jest to bardziej ogÃ³lny problem, ktÃ³ry nie ogranicza siÄ™ wyÅ‚Ä…cznie do obsÅ‚ugi Unicode: uÅ¼ytkownicy mogÄ… rÃ³wnieÅ¼ nazywaÄ‡ siebie innymi mylÄ…cymi nazwami, takimi jak "<site> Support", "admin " ze spacjÄ…, "admim" itp. )

Normalizacja: niektÃ³re znaki, takie jak â€Ã¶â€, mogÄ… byÄ‡ reprezentowane na wiele sposobÃ³w. MoÅ¼e to byÄ‡ albo pojedynczy znak U + 00F6 (LATIN MAÅY LITER O Z DIAERESISEM), albo dwa znaki U + 0061 U + 0308 (LATIN SMALL LETTER O + COMBINING DIAERESIS). Normalizacja to proces przeksztaÅ‚cania caÅ‚ego tekstu w formÄ™ zÅ‚oÅ¼onÄ… lub rozÅ‚oÅ¼onÄ…. JeÅ›li konsekwentnie nigdy nie korzystasz z normalizacji lub zawsze korzystasz z normalizacji, nie napotkasz problemÃ³w. JeÅ›li jednak tak siÄ™ dzieje, moÅ¼esz mieÄ‡ problemy z bezpieczeÅ„stwem:

Na przykÅ‚ad OS X normalizuje Unicode w nazwach plikÃ³w. ZaÅ‚Ã³Å¼my, Å¼e masz witrynÄ™ internetowÄ… bez kodu normalizacyjnego uruchomionÄ… na serwerze OS X, gdzie za kaÅ¼dym razem, gdy uÅ¼ytkownik siÄ™ rejestruje, tworzony jest plik z jego nazwÄ… i korzystasz z bazy danych bez normalizacji, aby Å›ledziÄ‡ nazwy uÅ¼ytkownikÃ³w, ktÃ³re zostaÅ‚y juÅ¼ zarejestrowane w kolejnoÅ›ci aby zapobiec ponownej rejestracji nazw. JeÅ›li masz uÅ¼ytkownika o nazwie â€foÃ¶â€ (uÅ¼ywajÄ…c U + 00F6), ktoÅ› inny moÅ¼e zarejestrowaÄ‡ konto o nazwie â€foÃ¶â€ (U + 0061 U + 0308), a witryna na to pozwoli, ale nadpisze plik utworzony przez pierwszy uÅ¼ytkownik â€foÃ¶â€. Aby rozwiÄ…zaÄ‡ ten problem, musisz albo konsekwentnie normalizowaÄ‡ aplikacjÄ™ w caÅ‚ej aplikacji, albo sprawdzaÄ‡ kolizje za kaÅ¼dym razem, gdy przekroczysz granicÄ™, ktÃ³ra normalizuje siÄ™ inaczej (gdy uÅ¼ytkownik siÄ™ zarejestruje i musisz utworzyÄ‡ plik dla nich , otwÃ³rz plik w trybie wyÅ‚Ä…cznoÅ›ci, aby nie powiÃ³dÅ‚ siÄ™, jeÅ›li plik juÅ¼ istnieje, i moÅ¼esz zablokowaÄ‡ rejestracjÄ™ nowego uÅ¼ytkownika).


